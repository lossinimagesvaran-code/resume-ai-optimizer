{% extends 'base.html' %}

{% block title %}Resume Preview - Resume AI Optimizer{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-10 mx-auto">
            <div class="card border-0 shadow-lg">
                <div class="card-body p-5">
                    <h1 class="text-center mb-4">
                        <i class="fas fa-eye me-2"></i>Resume Preview
                    </h1>
                    
                    <div class="mb-4">
                        <h5>Template: {{ tailored_resume.template_used|title }}</h5>
                        <p class="text-muted">Match Score: <strong>{{ tailored_resume.match_score }}%</strong></p>
                    </div>
                    
                    <div class="card-body">
                        <h5 class="card-title">{{ tailored_resume.template_type|title }} Resume Preview</h5>
                        <div class="resume-preview">
                            <div class="resume-content">
                                <textarea id="resume-content" name="content" class="form-control mb-3" rows="20" style="font-family: monospace; font-size: 14px; line-height: 1.4;">{{ cleaned_content }}</textarea>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <div class="row">
                                <div class="col-md-6">
                                    <button id="download-pdf-btn" class="btn btn-primary btn-lg w-100" onclick="downloadEditedPDF()">
                                        <i class="fas fa-download"></i> Download PDF
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <a href="{% url 'resume_tailoring:download' tailored_resume.id 'txt' %}" class="btn btn-outline-secondary btn-lg w-100">
                                        <i class="fas fa-file-text"></i> Download Text
                                    </a>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <a href="{% url 'resume_tailoring:home' %}" class="btn btn-outline-secondary w-100">
                                <i class="fas fa-redo me-2"></i>Create New
                            </a>
                        </div>
                    </div>

<script>
function downloadEditedPDF() {
    const editedContent = document.getElementById('resume-content').value;
    
    // Create a form to send the edited content
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '{% url "resume_tailoring:download_edited" tailored_resume.id %}';
    
    // Add CSRF token
    const csrfToken = '{{ csrf_token }}';
    const csrfInput = document.createElement('input');
    csrfInput.type = 'hidden';
    csrfInput.name = 'csrfmiddlewaretoken';
    csrfInput.value = csrfToken;
    form.appendChild(csrfInput);
    
    // Add edited content
    const contentInput = document.createElement('input');
    contentInput.type = 'hidden';
    contentInput.name = 'edited_content';
    contentInput.value = editedContent;
    form.appendChild(contentInput);
    
    // Submit form
    document.body.appendChild(form);
    form.submit();
    document.body.removeChild(form);
}
</script>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
